# HTTP 개관

전 세계의 웹브라우저, 서버, 웹 애플리케이션은 모두 **HTTP**(Hypertext Transfer Protocol)를 통해 서로 대화한다. HTTP는 현대 인터넷의 공용어이다.

## HTTP: 인터넷의 멀티미디어 배달부

HTTP는

- 전 세계의 **웹 서버로부터** **대량의 정보**(수십억 개의 JPEG 이미지, HTML 페이지, 텍스트 파일, 동영상, 음성 파일 등)를 빠르고, 간편하고, 정확하게 사람들의 PC에 설치된 **웹브라우저로 옮겨준다**.
- **신뢰성 있는 데이터 전송 프로토콜**을 사용하여, 전송 중 손상되지 않음을 보장한다. → 개발자는 인터넷의 결함이나 약점에 대한 걱정 없이 애플리케이션 고유의 기능을 구현하는 데 집중할 수 있다.

## 웹 클라이언트와 서버

웹 서버는 인터넷의 데이터를 저장하고, HTTP 클라이언트가 요청한 데이터를 제공한다.

**클라이언트**는 서버에게 ***HTTP 요청을 보내고*** **서버**는 ***요청된 데이터를 HTTP 응답으로 돌려준다***. HTTP 클라이언트와 HTTP 서버는 **월드 와이드 웹의 기본 요소**다.

## 리소스

웹 서버는 웹 리소스를 관리하고 제공한다. 웹 리소스는 웹 콘텐츠의 원천이다. 가장 단순한 웹 리소스는 웹 서버 파일 시스템의 정적 파일(텍스트 파일, 동영상 파일, 이미지 파일 등)이다.

그러나 리소스는 요청에 따라 ***콘텐츠를 생산하는 프로그램이 될 수도 있다***. 이러한 동적 콘텐츠 리소스는 사용자가 누구인지, 어떤 정보를 요청했는지, 몇 시인지에 따라 다른 콘텐츠를 생성한다. 

즉 웹 리소스란, ***웹에 콘텐츠를 제공하는 모든 것***을 말한다.

### 미디어 타입

인터넷은 수천 가지 데이터 타입을 다루기 때문에, HTTP는 웹에서 전송되는 객체 각각에 **MIME 타입**이라는 ***데이터 포맷 라벨***을 붙인다. 멀티미디어 콘텐츠를 기술하고 라벨을 붙이기 위해 사용된다. 

웹 서버는 모든 HTTP 객체 데이터에 MIME 타입을 붙인다. **웹브라우저는 서버로부터 객체를 돌려받을 때, 다룰 수 있는 객체인지 MIME 타입을 통해 확인**한다. 

MIME 타입은 사선(/)으로 구분된 주 타입(primary object type)과 부 타입(specific subtype)으로 이루어진 문자열 라벨이다.

예를 들면 다음과 같다.

- HTML 파일: text/html
- plain ASCII 텍스트 문서: text/plain
- JPEG 이미지: image/jpeg
- GIF 이미지: image/gif

### URI (uniform resource identifier)

웹 서버 리소스는 각자 이름을 갖고 있기 때문에, 클라이언트는 관심 있는 리소스를 지목할 수 있다. 서버 리소스 이름은 **통합 자원 식별자**(uniform resource identifier, **URI**)로 불린다. URI는 ***정보 리소스를 고유하게 식별하고 위치를 지정***할 수 있다.

예를 들어, '유진이의 기타 가게'의 웹 서버에 있는 이미지 리소스에 대한 URI라면 이런 식이다.

`http://www.yujins-guitar.com/guitars/telecaster.jpeg`

- `http://`
    - HTTP 프로토콜을 사용하라
- `www.yujins-guitar.com`
    - www.yujins-guitar.com으로 이동하라
- `/guitars/telecaster.jpeg`
    - /guitars/telecaster.jpeg라고 불리는 리소스를 가져와라

HTTP는 주어진 URI로 객체를 찾아온다.

URI에는 두 가지 종류가 있다. ***URL과 URN***이라는 것이다. 

### URL (uniform resource locator)

통합 자원 지시자(uniform resource locator, **URL**)는 리소스 식별자의 가장 흔한 형태다. ***특정 서버의 한 리소스에 대한 구체적인 위치를 서술***한다.

대부분의 URL은 세 부분으로 이루어진 표준 포맷을 따른다.

- **스킴**(scheme): 리소스에 접근하기 위해 사용되는 프로토콜 (예: `http://`)
- **서버**의 인터넷 **주소** (예: `www.yujins-guitar.com`)
- 웹 서버의 **리소스** (예: `/guitars/telecaster.jpeg`)

### URN (uniform resource name)

유니폼 리소스 이름(uniform resource name, **URN**)은 콘텐츠를 이루는 한 리소스에 대해, 그 ***리소스의 위치에 영향 받지 않는 유일무이한 이름*** 역할을 한다. 즉, 위치 독립적이다.

예를 들어, 다음의 URN은 인터넷 표준 문서 'RFC 2141'이 어디에 있거나 상관없이 이를 지칭하기 위해 사용할 수 있다.

`urn:ieft:rfc:2141`

URN은 여전히 실험 중인 상태이며 아직 널리 채택되지 않았다.

특별한 언급이 없으면, 앞으로 통상적인 관례에 따라 URI와 URL을 같은 의미로 사용할 것이다.

## 트랜잭션

HTTP 트랜잭션의 구성:

- 요청 명령(클라이언트→서버)

    ```
    GET /guitars/telecaster.jpeg HTTP/1.0
    Host: www.yujins-guitar.com
    ```

- 응답 결과(서버→클라이언트)

    ```
    HTTP/1.0 200 OK
    Content-type: image/gif
    Content-length: 8572
    ```

### 메서드

HTTP 메서드 = 요청 명령

모든 HTTP 요청 메시지는 한 개의 메서드를 갖는다.

서버에게 어떤 동작이 취해져야 하는지 말해준다.

- **GET**
    - 서버에서 클라이언트로 *지정한 리소스를 보내라*.
- **PUT**
    - 클라이언트에서 서버로 *보낸 데이터를 지정한 이름의 리소스로 저장*하라.
- **DELETE**
    - 지정한 리소스를 *서버에서 삭제*하라.
- **POST**
    - 클라이언트 *데이터를 서버 게이트웨이 애플리케이션으로 보내라*.
- **HEAD**
    - 지정한 리소스에 대한 응답에서, *HTTP 헤더 부분만 보내라*.

### 상태 코드

모든 HTTP 응답 메시지는 상태 코드와 함께 반환된다.

다음은 자주 쓰이는 상태코드 예시이다.

- **200**
    - 좋다. 문서가 바르게 반환되었다.
- **302**
    - 다시 보내라. 다른 곳에 가서 리소스를 가져가라.
- **404**
    - 리소스를 찾을 수 없다.

## 메시지

HTTP 메시지는 단순한 줄 단위의 문자열이다. 이진 형식이 아닌 일반 텍스트이기 때문에 사람이 읽고 쓰기 쉽다.

- 요청 메시지: 웹 클라이언트에서 웹 서버로 보낸 HTTP 메시지
- 응답 메시지: 서버에서 클라이언트로 가는 메시지

HTTP 메시지의 구성은 다음과 같다.

- 시작줄
    - 메시지의 첫 줄
    - 요청이라면 무엇을 해야 하는지, 응답이라면 무슨 일이 일어났는지
- 헤더
    - `이름:값`으로 구성
    - 빈 줄로 끝난다.
- 본문
    - 메시지 본문
    - 요청의 본문은 웹 서버로 데이터를 보낸다.
    - 응답의 본문은 클라이은터로 데이터를 반환한다.
    - 문자열이며, 임의의 *이진 데이터를 포함할 수 있다*.

## TCP(Transmission Control Protocol) 커넥션

어떻게 메시지가 TCP(Transmission Control Protocol, 전송 제어 프로토콜) 커넥션을 통해 한 곳에서 다른 곳으로 옮겨 가는지 알아보자.

### TCP/IP

> cf. HTTP는 애플리케이션 계층 프로토콜이다. HTTP는 네트워크 통신의 핵심적인 세부사항에 대해서 신경 쓰지 않으며, 인터넷 전송 프로토콜인 TCP/IP에게 맡긴다.

**TCP**는 다음을 제공한다.

- 오류 없는 데이터 전송
- 순서에 맞는 전달
- 조각나지 않는 데이터 스트림

**TCP/IP**는

- TCP와 IP가 층을 이루는 *패킷 교환 네트워크 프로토콜*의 집합이다.
- 어떤 종류의 컴퓨터나 네트워크든 서로 신뢰성 있는 의사소통을 하게 해준다.

HTTP 네트워크 프로토콜 스택은 다음과 같다.

```
HTTP                        애플리케이션 계층
-------------------------------------------
TCP                         전송 계층
-------------------------------------------
IP                          네트워크 계층
-------------------------------------------
네트워크를 위한 링크 인터페이스     데이터 링크 계층
-------------------------------------------
물리적인 네트워크 하드웨어         물리 계층
```

### 접속, IP 주소, 포트번호

클라이언트가 서버에 메시지를 전송할 수 있게 되기 전에, 인터넷 프로토콜(Internet protocol, **IP**) 주소와 **포트번호**를 ****사용해 **클라이언트와 서버 사이에 TCP/IP 커넥션을 맺어야** 한다.

HTTP 서버의 IP 주소와 포트번호를 알아내려면 URL을 이용하면 된다.

`http://{IP주소}:{포트번호}`

웹브라우저가 HTTP를 이용해서 서버의 HTML 리소스를 사용자에게 보여주는 순서는 다음과 같다.

1. 웹브라우저는 서버의 URL에서 **호스트 명을 추출**한다.
2. 웹브라우저는 서버의 **호스트 명을 IP로 변환**한다.
3. 웹브라우저는 URL에서 **포트번호**(있다면)를 **추출**한다.
4. 웹브라우저는 웹 서버와 **TCP 커넥션**을 맺는다!
5. 웹브라우저는 서버에 **HTTP 요청**을 보낸다.
6. 서버는 웹브라우저에 **HTTP 응답**을 돌려준다.
7. *커넥션이 닫히면, 웹브라우저는 문서를 보여준다*.

## 프로토콜 버전

HTTP 프로토콜은 버전이 여러 가지다.

- HTTP/0.9
    - GET 메서드만 지원한다.
    - MIME 타입, HTTP 헤더, 버전 번호를 지원하지 않는다.
- HTTP/1.0
    - 처음으로 널리 쓰이기 시작한 HTTP 버전이다.
    - 버전 번호, 헤더, 추가 메서드, 멀티미디어 객체 처리가 추가되었다.
- HTTP/1.0+
    - 오래 지속되는 "keep-alive" 커넥션 지원
    - 가상 호스팅 지원
    - 프락시 연결 지원
- **HTTP/1.1**
    - HTTP 설계의 구조적 결함 교정, 성능 최적화, 오기능 제거
    - 복잡해진 웹 애플리케이션과 배포 지원
    - *현재의 HTTP 버전*이다!
- HTTP/2.0
    - 구글의 SPDY 프로토콜 기반으로 설계가 진행 중이다.

## 웹의 구성요소

### 프락시

클라이언트와 서버 사이에 위치한 HTTP 중개자

- 클라이언트의 모든 HTTP 요청을 받아 서버에 전달한다.
- 주로 보안을 위해 사용된다.
- 요청과 응답을 필터링한다.

### 캐시

많이 찾는 웹페이지를 클라이언트 가까이에 보관하는 HTTP 창고

- 웹캐시와 캐시 프락시는 자신을 거쳐 가는 문서들 중 자주 찾는 것의 사본을 저장해 두는 특별한 종류의 HTTP 프락시 서버다.
- 멀리 떨어진 웹 서버보다 근처의 캐시에서 훨씬 더 빨리 문서를 다운 받을 수 있다.

### 게이트웨이

다른 애플리케이션과 연결된 특별한 웹 서버

- 주로 *HTTP 트래픽을 다른 프로토콜로 변환*하기 위해 사용된다.
- 리소스를 갖고 있는 진짜 서버인 것처럼 요청을 다룬다.
- HTTP/FTP 게이트웨이는 FTP URI에 대한 HTTP 요청을 받아들인 뒤, FTP 프로토콜을 이용해 문서를 가져와 HTTP 메시지에 담아 클라이언트에게 보낸다.

### 터널

HTTP 통신을 전달하기만 하는 특별한 프락시

- 두 커넥션 사이에서 raw 데이터를 열어보지 않고 그대로 전달해주는 HTTP 애플리케이션이다.
- 주로 *비 HTTP 데이터를* 하나 이상의 *HTTP 연결을 통해 그대로 전송*해주기 위해 사용된다.
- 예시: 암호화된 SSL 트래픽을 HTTP 커넥션으로 전송함으로써 웹 트래픽만 허용하는 사내 방화벽을 통과시키는 것
    - HTTP/SSL 터널은 HTTP 요청을 받아들여 목적지 주소와 포트번호로 커넥션을 맺는다.
    - 암호화된 SSL 트래픽을 HTTP 채널을 통해 목적지 서버로 전송할 수 있게 된다.

### 에이전트

자동화된 HTTP 요청을 만드는 준지능적 웹클라이언트

- 사용자를 위해 HTTP 요청을 만들어주는 클라이언트 프로그램이다.
- 예시: 사람의 통제 없이 스스로 웹을 돌아다니며 HTTP 트랜잭션을 일으키고 콘텐츠를 받아오는 자동화된 사용자 에이전트, '스파이더', '웹로봇'