# HTTP 메시지

## 메시지의 흐름

**HTTP 메시지**는 *HTTP 애플리케이션 간에 주고받은 데이터의 블록들*이다. 이 데이터의 블록들은 메시지의 내용과 의미를 설명하는 텍스트 메타 정보로 시작하고 그 다음에 선택적으로 데이터가 올 수 있다.

### 메시지는 원 서버 방향을 인바운드로 하여 송신된다

HTTP는 **인바운드**와 **아웃바운드**라는 용어를 **트랜잭션 방향**을 표현하기 위해 사용한다.

- **인바운드**로 이동하는 것
    - 메시지가 원 **서버로** 향하는 것
- **아웃바운드**로 이동하는 것
    - 모든 처리가 끝난 뒤에 메시지가 **사용자 에이전트로** 돌아오는 것

### 다운스트림으로 흐르는 메시지

HTTP 메시지는 강물과 같이 흐른다. 모든 메시지는 다운스트림으로 흐른다. 메시지의 발송자는 수신자의 업스트림이다. 

## 메시지의 각 부분

각 메시지는 클라이언트로부터의 요청이나 서버로부터의 응답 중 하나를 포함한다. 메시지는 시작줄, 헤더 블록, 본문 이렇게 세 부분으로 이루어진다. 시작줄은 이것이 어떤 메시지인지 서술하며, 헤더 블록은 속성을, 본문은 데이터를 담고 있다. 본문은 아예 없을 수도 있다.

예)

- 시작줄

    ```bash
    HTTP/1.0 200 OK
    ```

- 헤더

    ```bash
    Content-type: text
    Content-length: 19
    (빈 줄)
    ```

- 본문

    ```bash
    Hi ~ I'm a message !
    ```

### 메시지 문법

모든 HTTP 메시지는 요청 메시지나 응답 메시지로 분류된다. 요청 메시지는 웹 서버에 어떤 동작을 요구한다. 응답 메시지는 요청의 결과를 클라이언트에게 돌려준다. 요청과 응답 모두 기본적으로 구조가 같다.

- 요청 메시지

    ```bash
    <메서드> <요청 URL> <버전>
    <헤더>

    <엔터티 본문>
    ```

- 응답 메시지

    ```bash
    <버전> <상태코드> <사유 구절>
    <헤더>

    <엔터티 본문>
    ```

각 부분에 대한 설명은 다음과 같다.

- 메서드
    - 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작
    - 'GET', 'HEAD', 'POST' 등의 한 단어로 되어 있다
- 요청 URL
    - 요청 대상이 되는 리소스를 지칭하는 완전한 URL 혹은 URL의 경로 구성요소
- 버전
    - 메시지에서 사요 중인 HTTP의 버전
    - 형식: `HTTP/<메이저>.<마이너>`
- 상태 코드
    - 요청 중에 무엇이 일어났는지 설명하는 세 자리의 숫자
- 사유 구절
    - 숫자로 된 상태 코드의 의미를 사람이 이해할 수 있게 설명해주는 짧은 문구
    - 사람에게 읽히기 위한 목적으로만 존재
- 헤더들
    - 이름, 콜론(:), 선택적인 공백, 값, CLRF가 순서대로 나타나는 0개 이상의 헤더들
    - 헤더의 목록은 빈 줄(CRLF)로 끝나 헤더 목록의 끝과 엔터티 본문의 시작을 표시
- 엔터티 본문
    - 임의의 데이터 블록을 포함

### 시작줄

모든 HTTP 메시지는 시작줄로 시작한다.

- 요청줄
    - **메서드**: 서버에서 어떤 동작이 일어나야 하는지 설명
    - **요청 URL**: 동작에 대한 대상을 지칭
    - **HTTP 버전**: 클라이언트가 어떤 HTTP버전으로 말하고 있는지 서버에게 알려줌
    - 모든 필드는 공백으로 구분
- 응답줄
    - **HTTP 버전**: 응답 메시지에서 쓰인 HTTP의 버전
    - **상태 코드**: 숫자로 되어 있음
    - **사유 구절**: 수행 상태에 대해 설명해주는 텍스트
    - 모든 필드는 공백으로 구분
- 메서드
    - GET
        - 서버에서 어떤 문서를 가져온다
    - HEAD
        - 서버에서 어떤 문서에 대해 헤더만 가져온다
    - POST
        - 서버가 처리해야 할 데이터를 보낸다
        - 메시지 본문 포함
    - PUT
        - 서버에 요청 메시지의 본문을 저장한다
        - 메시지 본문 포함
    - TRACE
        - 메시지가 프락시를 거쳐 서버에 도달하는 과정을 추적한다
    - OPTIONS
        - 서버가 어떤 메서드를 수행할 수 있는지 확인한다
    - DELETE
        - 서버에서 문서를 제거한다
    - 확장 메서드
        - HTTP는 쉽게 확장할 수 있도록 설계되었기 때문에, 특정 서버만의 추가 메서드를 구현할 수 있다
- 상태 코드
    - 클라이언트에게 무엇이 일어났는지 말해준다
    - 응답의 시작줄에 위치한다
    - 세 자리 숫자로 된 코드값을 기준으로 분류된다

        | 전체범위 | 정의된 범위 | 분류 |
        |--------|------|------|
        | 100-199 | 100-101 | 정보 |
        | 200-299 | 200-206 | 성공 |
        | 300-399 | 300-305 | 리다이렉션 |
        | 400-499 | 400-415 | 클라이언트 에러 |
        | 500-599 | 500-505 | 서버 에러 |

    - 많이 쓰이는 상태 코드

        | 상태 코드 | 사유 구절 | 의미 |
        |--------|------|------|
        | 200 | OK | 성공. 요청한 모든 데이터는 응답 본문에 들어있다 |
        | 401 | Unauthorized | 사용자 이름과 비밀번호를 입력해야 한다 |
        | 404 | Not Found | 서버는 요청한 URL에 해당하는 리소스를 찾지 못했다 |

- 사유 구절
    - 응답 시작줄의 마지막 구성요소
    - 상태 코드에 대한 글로 된 설명 제공
- 버전 번호
    - HTTP/x.y 형식
    - 요청과 응답 메시지 양쪽 모두에 기술
    - HTTP 애플리케이션들이 자신이 따르는 프로토콜의 버전을 상대방에게 말해주기 위한 수단

### 헤더

시작줄 다음에는 0~여러 개의 HTTP 헤더가 온다.

기본적으로 이름/값 쌍의 목록이다.

- 헤더 분류
    - 일반 헤더
        - 요청과 응답 양쪽에 모두 나타날 수 있음
    - 요청 헤더
        - 요청에 대한 부가 정보 제공
    - 응답 헤더
        - 응답에 대한 부가 정보 제공
    - Entity 헤더
        - 본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술
    - 확장 헤더
        - 명세에 정의되지 않은 새로운 헤더
- 문법
    - 이름, 쉼표, 공백(옵션), 필드 값, CRLF가 순서대로 온다.
- 예시

    | 헤더의 예 | 설명 |
    |--------|------|
    | Date: Tue. 3 Oct 1997 02:16:03 GMT | 서버가 응답을 만들어 낸 시각 |
    | Content-length: 15040 | 15,040바이트의 데이터를 포함한 엔터티 본문 |
    | Content-type: image/gif | 엔터티 본문은 GIF 이미지다 |
    | Accept: image(gif, image/jpeg, text/html | 클라이언트는 GIF, JPEG 이미지와 HTML을 받아들일 수 있다 |

- 헤더를 여러 줄로 나누기
    - 추가 줄 앞에 최소 하나의 스페이스 혹은 탭 문자가 와야 한다

### 엔터티 본문

HTTP 메시지의 세 번째 부분은 선택적인 엔터티 본문이다. 이는 HTTP가 수송하도록 설계된 것들이다.

HTTP 메시지는 이미지, 비디오, HTML 문서, 소프트웨어 애플리케이션, 신용카드 트랜잭션, 전자우편 등 여러 종류의 디지털 데이터를 실어 나를 수 있다.

### 버전 0.9 메시지

HTTP 버전 0.9는 HTTP 프로토콜의 초기 버전이다.

- 요청
    - 메서드와 요청URL로 구성
- 응답
    - 엔터티로만 구성