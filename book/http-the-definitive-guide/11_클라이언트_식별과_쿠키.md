# 클라이언트 식별과 쿠키

## 개별 접촉

HTTP는 익명, 상태가 없고 요청과 응답으로 통신하는 프로토콜이다.

서버는 클라이언트가 보낸 요청을 처리 후 응답을 클라이언트에게 전송한다. 웹 서버는 요청을 보낸 사용자를 식별하거나 방문자가 보낸 연속적인 요청을 추적하기 위해 약간의 정보를 이용할 수 있다. 

* 개별 인사
* 사용자 맞춤 추천
* 저장된 사용자 정보
* 세션 추적
    * HTTP 트랜잭션은 상태가 없다. 각 요청 및 응답은 독립적이다. 많은 웹사이트에서 사용자가 사이트와 상호작용할 수 있게 사용자의 상태를 남긴다. (ex. 장바구니) 이렇게 상태를 유지하기 위해 사이트는 사용자에게서 오는 HTTP 트랜잭션을 식별할 방법이 필요하다.

## HTTP 헤더

* 사용자에 대한 정보를 전달하는 HTTP 헤더

    헤더 이름 | 헤더 타입 | 설명
    --- | --- | --- 
    From | 요청 | 사용자의 이메일 주소 
    User-Agent | 요청 | 사용자의 브라우저
    Referer | 요청 | 사용자가 현재 링크를 타고 온 근원 페이지
    Authorization | 요청 | 사용자 이름과 비밀번호
    Client-ip | 확장(요청) | 클라이언트의 IP 주소
    X-Forwarded-For | 확장(요청) | 클라이언트의 IP 주소
    Cookie | 확장(요청) | 서버가 생성한 ID 라벨
    
## 클라이언트 IP 주소

클라이언트 IP 주소로 사용자를 식별하는 방식은 다음과 같은 약점을 갖는다.
* 클라이언트 IP 주소는 사용자가 아닌, 사용하는 컴퓨터를 가리킨다. 만약 여러 사용자가 같은 컴퓨터를 사용한다면 그들을 식별할 수 없다.
* 많은 인터넷 서비스 제공자(ISP)는 사용자가 로그인하면 동적으로 IP 주소를 할당한다. 로그인한 시간에 따라 사용자는 매번 다른 주소를 받는다.
* 사용자가 네트워크 주소 변환(Network Address Translation, NAT) 방화벽을 통해 인터넷을 사용한다. NAT 장비들은 클라이언트의 실제 IP 주소를 방화벽 뒤로 숨기고 클라이언트의 실제 IP 주소를 내부에서 사용하는 하나의 방화벽 IP주소로 변환한다.
* 보통 HTTP 프락시와 게이트웨이는 원 서버에 새로운 TCP 연결을 한다. 웹 서버는 클라이언트 IP 주소 대신 프락시 서버의 IP 주소를 본다. 

## 사용자 로그인

HTTP는 WWW-Authenticate와 Authorization 헤더를 사용해 웹 사이트에 사용자 이름을 전달하는 체계를 가지고 있다.

## 뚱뚱한 URL

어떤 웹 사이트는 사용자의 URL마다 버전을 기수랗여 사용자를 식별하고 추적하였다. URL 경로의 처음이나 끝에 어떤 상태 정보를 추가해 확장한다. 사용자가 그 사이트를 돌아다니면, 웹 서버는 URL에 있는 상태 정보를 유지하는 하이퍼링크를 동적으로 생성한다. 이렇게 사용자의 상태 정보를 포함하고 있는 URL을 뚱뚱한 URL이라고 부른다. 

웹 서버와 통신하는 독립적인 HTTP 트랜잭션을 하나의 '세션' 또는 '방문'으로 묶는 용도로 이를 사용할 수 있다. 사용자가 사이트 처음 방문시 unique한 ID가 생성되고 서버가 인식할 수 있는 방식으로 URL에 추가되며 서버는 클라이언트를 이 뚱뚱한 URL로 리다이렉트 시킨다.

그러나 뚱뚱한 URL은 다음과 같은 문제점을 갖는다.

* 못생긴 URL
* 공유하지 못하는 URL
* 캐시를 사용할 수 없음
* 서버 부하 가중
* 이탈
* 세션 간 지속성의 부재

## 쿠키

