# 통합점: 게이트웨이, 터널, 릴레이

* 게이트웨이: 서로 다른 프로토콜과 애플리케이션 간의 HTTP 인터페이스
* 애플리케이션 인터페이스: 서로 다른 형식의 웹 애플리케이션이 통신하는 데 사용
* 터널: HTTP 커넥션을 통해서 HTTP가 아닌 트래픽을 전송하는 데 사용
* 릴레이: 일종의 단순한 HTTP 프락시로, 한 번에 한 개의 홈에 데이터를 전달하는 데 사용

## 게이트웨이

게이트웨이는 **리소스와 애플리케이션을 연결**하는 역할을 한다. 애플리케이션은 게이트웨이에게 요청을 처리해달라고 할 수 있고(HTTP 또는 그 밖의 정의해 둔 인터페이스를 통해), 게이트웨이는 그에 응답할 수 있다. 게이트웨이는 요청을 받고 응답을 보내는 포털 같이 동작하는데, 동적인 콘텐츠를 생성하거나 데이터베이스에 질의를 보낼 수 있다.

게이트웨이는 **HTTP 트래픽을 다른 프로토콜로 자동으로 변환**하여, HTTP 클라이언트가 다른 프로토콜을 알 필요 없이 서버에 접속할 수 있게 하기도 한다.

### 클라이언트 측 게이트웨이와 서버 측 게이트웨이

웹 게이트웨이는 한쪽에서는 HTTP로 통신하고 다른 한쪽에서는 HTTP가 아닌 다른 프로토콜로 통신한다. 게이트웨이는 클라이언트 측 프로토콜과 서버 측 프로토콜을 슬래쉬(/)로 구분해 기술한다.

* 서버 측 게이트웨이는 클라이언트와 HTTP로 통신하고, 서버와는 외래 프로토콜로 통신한다.
* 클라이언트 측 게이트웨이는 클라이언트와 외래 프로토콜로 통신하고, 서버와는 HTTP로 통신한다.

## 프로토콜 게이트웨이

게이트웨이에 HTTP 트래픽을 바로 보낼 수 있다. 브라우저에 명시적으로 게이트웨이를 설정하여 트래픽이 게이트웨이를 거쳐 가게 하거나, 게이트웨이를 대리 서버(리버스 프락시)로 설정할 수 있다. 

### HTTP/*: 서버 측 웹 게이트웨이

서버 측 웹 게이트웨이는 클라이언트로부터 HTTP 요청이 원 서버 영역으로 들어오는 시점에 클라이언트 측의 HTTP 요청을 외래 프로토콜로 전환한다.

게이트웨이는 객체를 받는 대로 HTTP 응답에 실어서 클라이언트에 전송할 것이다.

### HTTP/HTTPS: 서버 측 보안 게이트웨이

기업 내부의 모든 웹 요청을 암호화함으로써 개인 정보 보호와 보안을 제공하는데 게이트웨이를 사용할 수 있다. 클라이언트는 일반 HTTP를 사용하여 웹을 탐색할 수 있지만, 게이트웨이는 자동으로 사용자의 모든 세션을 암호화할 것이다.

### HTTPS/HTTP: 클라이언트 측 보안 가속 게이트웨이

HTTPS/HTTP 게이트웨이는 보안 가속기로 유명하다. 웹 서버의 앞단에 위치하고, 보이지 않는 인터셉트 게이트웨이나 리버스 프락시 역할을 한다. 보안 HTTPS 트래픽을 받아서 복호화하고, 웹 서버로 보낼 일반 HTTP 요청을 만든다.

원 서버보다 더 효율적으로 보안 트래픽을 복호화하는 암호화 하드웨어를 내장해서 원 서버의 부하를 줄여주기도 한다. 하지만 이는 게이트웨이와 원 서버 간의 암호화하지 않은 트래픽을 전송하기 때문에, 게이트웨이와 원 서버 간에 있는 네트워크가 안전한지 확인을 확실히 하고 사용해야 한다.

## 리소스 게이트웨이

게이트웨이의 가장 일반적인 형태인 애플리케이션 서버는 목적지 서버와 게이트웨이를 한 개의 서버로 결합한다. 애플리케이션 서버는 HTTP를 통해서 클라이언트와 통신하고 서버 측에 있는 애플리케이션 프로그램에 연결하는 서버 측 게이트웨이다.

애플리케이션 게이트웨이에서 유명했던 최초의 API는 **공용 게이트웨이 인터페이스(Common Gateway Interface, CGI)**였다. CGI는 특정 URL에 대한 HTTP 요청에 따라 프로그램을 실행하고, 프로그램의 출력을 수집하고, HTTP 응답으로 회신하는데 웹 서버가 사용하는 표준화된 인터페이스 집합이다.

게이트웨이를 통해야 받을 수 있는 리소스 요청이 들어오면, 서버는 헬퍼 애플리케이션을 생성하여 요청을 처리한다. 헬퍼 애플리케이션은 필요한 데이터를 전달 받는다. 그 다음, 바로 클라이언트로 전달할 응답이나 응답 데이터를 서버에 반환한다. 서버와 게이트웨이는 별개의 애플리케이션이기 때문에 각각 가지고 있는 책임은 분명히 나뉘어 있다. 

### 공용 게이트웨이 인터페이스

공용 게이트 인터페이스(CGI)는 최초의 **서버 확장**이자 지금까지도 가장 널리 쓰이는 서버 확장이다. 이는 웹에서 동적인 HTML, 신용카드 처리, 데이터베이스 질의 등을 제공하는 데 사용한다.

CGI 애플리케이션이 서버와 분리되면서 펄(Perl), Tcl, C, 다양한 셸 언어를 포함하여 수많은 언어로 구현할 수 있게 되었다. CGI는 단순하므로 대부분의 HTTP 서버가 지원한다.

CGI가 내부에서 어떤 처리를 하는지는 사용자에게 보이지 않는다. 사용자의 시각에서는 CGI가 내부적으로 일반적인 요청을 만드는 것일 뿐이다. 서버와 CGI 애플리케이션 간에 진행되는 처리 단계를 감춘다. 클라이언트가 CGI 애플리케이션이 무언가를 하고 있다는 것을 알 수 있는 단서는 URL에 있는 'cgi' 또는 '?' 같은 것들 뿐이다.

CGI는 거의 모든 리소스 형식과 서버의 접점에 있으면서 필요에 따라 어떤 변형이든 처리해내는 단순한 기능을 제공한다. 

그러나 모든 CGI 요청마다 새로운 프로세스를 만드는 데 따르는 부하가 크고, CGI를 사용하는 서버의 성능을 제한하며 서버 장비에 부담을 주는 문제를 피하고자 Fast CGI가 개발되었다. CGI와 유사하지만 데몬으로 동작함으로써 요청마다 새로운 프로세스를 만들고 제거하면서 생기는 성능 저하 문제를 해결하였다.

### 서버 확장 API

서버 자체의 동작을 바꾸고 싶거나 서버의 처리 능력을 최고치로 끌어 올리고 싶을 경우를 위하여, 서버 개발자는 웹 개발자가 자신의 모듈을 HTTP와 직접 연결할 수 있는 인터페이스인 서버 확장 API를 제공하였다. 확장 API는 프로그래머가 자신의 코드를 서버에 연결하거나 서버의 컴포넌트를 자신이 만든 것으로 교체해버릴 수 있게 하였다.

유명한 서버 대부분은 개발자에게 확장 API를 하나 이상 제공한다. 이러한 확장은 서버 자체의 아키텍처에 의존하기 때문에, 대부분 한 가지 서버 형식으로 특화되었다. 서버들은 개발자가 서버의 동작을 변경하거나 다른 리소스에 대한 사용자 맞춤 인터페이스를 제공하는 데 쓸 수 있는 API를 갖는다. 이는 개발자에게 매우 유용하다.

서버 확장의 한 가지 예는, 마이크로소프트의 프론트페이지 서버 확장(FPSE)이다. 프론트페이지 클라이언트로부터 전송되는 원격 프로시져 호출(RPC) 명령을 인식할 수 있다. 이 명령은 HTTP에 편승하여 온다.

## 애플리케이션 인터페이스와 웹 서비스

애플리케이션을 연결하면서 생기는 까다로운 이슈 중 하나는, 데이터를 교환하려는 두 애플리케이션 사이에서 프로토콜 인터페이스를 맞추는 일이다. 애플리케이션이 상호 운용을 하다보면 HTTP 헤더로는 표현하기 힘든 복잡한 정보를 교환해야 할 수도 있다. 

## 터널

웹 터널은 HTTP 프로토콜을 지원하지 않는 애플리케이션에 HTTP 애플리케이션을 사용해 접근하는 방법을 제공한다. 웹 터널을 사용하면 HTTP 커넥션을 통해서 HTTP가 아닌 트래픽을 전송할 수 있고, 다른 프로토콜을 HTTP 위에 올릴 수 있다.

### CONNECT로 HTTP 터널 커넥션 맺기

웹 터널은 HTTP의 CONNECT 메서드를 사용하여 커넥션을 맺는다.

CONNECT 메서드는 터널 게이트웨이가 임의의 목적 서버와 포트에 TCP 커넥션을 맺고 클라이언트와 서버 간에 오는 데이터를 무조건 전달하기를 요청한다.

* CONNECT 요청
  EX)
  ```
  CONNECT home.netscape.com:443 HTTP/1.0
  User-agent: Mozilla/4.0
  ```

* CONNECT 응답
  EX)
  ```
  HTTP/1.0 200 Connection Established
  Proxy-agent: Netscape-Proxy/1.1
  ```
  커넥션이 메시지를 전달하는 대신 바이트를 그대로 전달하기 때문에 콘텐츠의 형식을 기술하는 **Content-Type** 헤더를 포함할 필요가 없다.

### SSL 터널링

웹 터널은 방화벽을 통해서 암호화된 SSL 트래픽을 전달하려고 개발되었다. SSL 같이 암호화된 프로토콜은 정보가 암호화되어 있기 때문에 낡은 방식의 프락시에서는 처리되지 않는다. **터널을 사용하면 SSL 트래픽을 HTTP 커넥션으로 전송**하여 80 포트의 HTTP만을 허용하는 **방화벽을 통과**시킬 수 있다.

터널링 기능은 HTTP 메시지에 암호화된 날 데이터를 담고 일반 HTTP 채널을 통해 데이터를 전송한다.

### SSL 터널링 vs HTTP/HTTPS 게이트웨이

### 터널 인증

### 터널 보안에 대한 고려사항들

## 릴레이
